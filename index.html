<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SecretShop - Get Paid for Your Feedback</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <div class="nav-container">
      <div class="logo">
        <span class="logo-icon">üõçÔ∏è</span>
        <span class="logo-text">SecretShop</span>
      </div>
      <nav class="nav-menu">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#how-it-works">How it Works</a>
        <a href="#contact">Contact</a>
        <div class="admin-dropdown">
          <button class="admin-btn" onclick="toggleAdminMenu()">Admin ‚ñº</button>
          <div id="adminMenu" class="admin-menu" style="display: none;">
            <a href="#" onclick="toggleLogin()">Login</a>
            <a href="#" onclick="toggleAdminDashboard()">Dashboard</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="hero" id="home">
    <div class="stars"></div>
    <div class="person-on-phone">
      <span class="person">üì±</span>
      <span class="money">üí∞</span>
    </div>
    <div class="content">
      <h1 class="title">SecretShop</h1>
      <p class="subtitle">Watch, Review & Get Paid Instantly</p>
      <div class="features">
        <div class="feature">
          <div class="icon">üé•</div>
          <h3>Promotional Reels</h3>
          <p>Watch brand ads under 30 seconds and earn rewards</p>
        </div>
        <div class="feature">
          <div class="icon">üß†</div>
          <h3>Give Feedback</h3>
          <p>Answer brand questions via text, voice or video</p>
        </div>
        <div class="feature">
          <div class="icon">üí∏</div>
          <h3>Instant UPI Rewards</h3>
          <p>Receive money instantly for your opinions</p>
        </div>
      </div>
    </div>
    <div class="phone-mockup">
      <div class="phone">
        <div class="screen">
          <iframe
            class="app-demo-video"
            width="100%"
            height="100%"
            src="https://www.youtube.com/embed/3HxClDk1Wyo?autoplay=1&mute=1&loop=1&playlist=3HxClDk1Wyo"
            title="SecretShop Demo"
            frameborder="0"
            allow="autoplay; encrypted-media"
            allowfullscreen
          ></iframe>
        </div>
      </div>
    </div>
  </div>

  <section class="about" id="about">
    <h2>India's First Instant Feedback Marketplace</h2>
    <p>SecretShop lets users earn money by watching short brand ads and answering simple questions. For brands, it's a new way to test ads, concepts, and ideas with real users across India ‚Äî in hours, not weeks.</p>
  </section>

  <section class="screenshot" id="how-it-works">
    <h2>How SecretShop Works</h2>
    <div class="screenshot-grid">
      <div class="screenshot">
        <img src="ss1.jpg" alt="Watch and Earn" />
        <p>Watch promo videos and earn ‚Çπ instantly</p>
      </div>
      <div class="screenshot">
        <img src="ss2.jpg" alt="Give Feedback" />
        <p>Record your honest opinion in video, voice or text</p>
      </div>
      <div class="screenshot">
        <img src="ss3.jpg" alt="Brand Insights" />
        <p>Brands get real reactions & emotional insights</p>
      </div>
    </div>
  </section>

  <section class="brand-download">
  <div class="brand-left">
    <h2>For Brands & Startups</h2>
    <p>Get real-time, honest, emotional feedback on your ads, products, designs, and concepts from your target users. Stop guessing. Start testing.</p>
    
    <div class="brand-grid">
      <div class="brand-card">
        <div class="icon">üìä</div>
        <h3>Concept Testing</h3>
        <p>Upload product ideas, packaging, logos</p>
      </div>
      <div class="brand-card">
        <div class="icon">üéØ</div>
        <h3>Targeted Viewers</h3>
        <p>Select your audience based on interest, location & more</p>
      </div>
      <div class="brand-card">
        <div class="icon">üì•</div>
        <h3>Feedback Dashboard</h3>
        <p>View answers, reactions, and metrics from real users</p>
      </div>
    </div>
  </div>

  <div class="brand-right">
    <h2>Join SecretShop Today</h2>
    <a href="#">
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Get it on Google Play" style="height:60px;" />
    </a>
    <p class="note">iOS coming soon</p>
  </div>
</section>

  <section class="contact" id="contact">
    <h2>Get in Touch</h2>
    <div class="contact-grid">
      <div class="contact-item">
        <div class="icon">üìß</div>
        <h3>Email</h3>
        <p>support@mystoryverse.online</p>
      </div>
      <div class="contact-item">
        <div class="icon">üìû</div>
        <h3>Phone</h3>
        <p>We will add our phone soon</p>
      </div>
      <div class="contact-item">
        <div class="icon">üì¢</div>
        <h3>Instagram</h3>
        <p>@SecretShopApp</p>
      </div>
    </div>
  </section>

  <section class="support">
    <h2>Support Our Mission</h2>
    <p>We're building India's largest feedback & reward network. Help us grow!</p>
    <a href="https://coff.ee/aravindredx" class="coffee-btn" target="_blank">
      <span class="coffee-icon">‚òï</span>
      Buy us a coffee
    </a>
  </section>

  <!-- Login Modal -->
  <div id="loginModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="toggleLogin()">&times;</span>
      <h2>Admin Login</h2>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
    </div>
  </div>

  <!-- Admin Dashboard Section -->
  <section id="adminDashboard" class="admin-dashboard" style="display: none;">
    <div class="admin-container">
      <h2>SecretShop Admin Dashboard</h2>
      
      <div class="admin-tabs">
        <button class="admin-tab-btn active" onclick="showAdminTab('transactions')">Pending Transactions</button>
        <button class="admin-tab-btn" onclick="showAdminTab('results')">Task Results</button>
        <button class="admin-tab-btn" onclick="showAdminTab('tasks')">Add Task</button>
        <button class="admin-tab-btn" onclick="showAdminTab('promotions')">Add Promotion</button>
      </div>

      <div id="admin-transactions" class="admin-tab-content active">
        <table id="adminTransactionsTable">
          <thead>
            <tr><th>User</th><th>Task</th><th>Amount</th><th>Date</th><th>Action</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="admin-results" class="admin-tab-content">
        <h3>Task Performance Dashboard</h3>
        <div id="taskResultsContainer"></div>
      </div>

      <div id="admin-tasks" class="admin-tab-content">
        <form id="adminTaskForm">
          <input type="text" id="adminBrandName" placeholder="Brand Name" required>
          <textarea id="adminQuestion" placeholder="Question" required></textarea>
          <input type="number" id="adminReward" placeholder="Reward Amount" required>
          <input type="number" id="adminTarget" placeholder="User Target" required>
          <input type="url" id="adminImageUrl" placeholder="Image URL" required>
          <button type="submit">Add Task</button>
        </form>
      </div>

      <div id="admin-promotions" class="admin-tab-content">
        <form id="adminPromoForm">
          <input type="text" id="adminPromoTitle" placeholder="Title" required>
          <textarea id="adminPromoDesc" placeholder="Description" required></textarea>
          <input type="url" id="adminVideoUrl" placeholder="Video URL" required>
          <input type="number" id="adminPromoReward" placeholder="Reward Amount" required>
          <button type="submit">Add Promotion</button>
        </form>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="footer-links">
      <a href="privacy.html">Privacy Policy</a>
      <a href="terms.html">Terms & Conditions</a>
      <a href="#about">About</a>
    </div>
    <p class="footer-text">¬© 2025 SecretShop. Built with ‚ù§Ô∏è in India.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase config
    const SUPABASE_URL = 'YOUR_SUPABASE_URL';
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function toggleAdminMenu() {
      const menu = document.getElementById('adminMenu');
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    function toggleLogin() {
      const modal = document.getElementById('loginModal');
      modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
      document.getElementById('adminMenu').style.display = 'none';
    }

    function toggleAdminDashboard() {
      const dashboard = document.getElementById('adminDashboard');
      dashboard.style.display = dashboard.style.display === 'none' ? 'block' : 'none';
      document.getElementById('adminMenu').style.display = 'none';
      if (dashboard.style.display === 'block') loadAdminTransactions();
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        const { data, error } = await supabaseClient.auth.signInWithPassword({
          email: email,
          password: password
        });
        
        if (error) throw error;
        
        // Check if user is admin
        const { data: profile } = await supabaseClient
          .from('user_profiles')
          .select('user_type')
          .eq('user_id', data.user.id)
          .single();
        
        if (profile?.user_type === 'Admin') {
          alert('Login successful!');
          toggleLogin();
          toggleAdminDashboard();
        } else {
          alert('Access denied. Admin privileges required.');
          await supabaseClient.auth.signOut();
        }
      } catch (error) {
        alert('Login failed: ' + error.message);
      }
    });

    function showAdminTab(tab) {
      document.querySelectorAll('.admin-tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(`admin-${tab}`).classList.add('active');
      event.target.classList.add('active');
      if (tab === 'transactions') loadAdminTransactions();
      if (tab === 'results') loadTaskResults();
    }

    async function loadAdminTransactions() {
      try {
        const { data, error } = await supabaseClient
          .from('task_responses')
          .select(`
            id,
            created_at,
            user_profiles!inner(name),
            brand_tasks!inner(brand_name, reward_amount)
          `)
          .eq('reward_status', 'pending');
        
        if (error) throw error;
        
        const tbody = document.querySelector('#adminTransactionsTable tbody');
        tbody.innerHTML = data?.length ? data.map(t => `
          <tr>
            <td>${t.user_profiles?.name || 'Unknown'}</td>
            <td>${t.brand_tasks?.brand_name || 'Unknown'}</td>
            <td>‚Çπ${t.brand_tasks?.reward_amount || 0}</td>
            <td>${new Date(t.created_at).toLocaleDateString()}</td>
            <td>
              <button class="approve-btn" onclick="approveTransaction('${t.id}')">Approve</button>
              <button class="reject-btn" onclick="rejectTransaction('${t.id}')">Reject</button>
            </td>
          </tr>
        `).join('') : '<tr><td colspan="5">No pending transactions</td></tr>';
      } catch (error) {
        console.error('Error loading transactions:', error);
        document.querySelector('#adminTransactionsTable tbody').innerHTML = 
          '<tr><td colspan="5">Error loading transactions</td></tr>';
      }
    }

    async function approveTransaction(id) {
      try {
        const { error } = await supabaseClient
          .from('task_responses')
          .update({ reward_status: 'paid' })
          .eq('id', id);
        
        if (error) throw error;
        
        alert('Transaction approved! User wallet will be updated.');
        loadAdminTransactions();
      } catch (error) {
        alert('Error approving transaction: ' + error.message);
      }
    }

    async function rejectTransaction(id) {
      if (!confirm('Are you sure you want to reject this transaction?')) return;
      
      try {
        const { error } = await supabaseClient
          .from('task_responses')
          .delete()
          .eq('id', id);
        
        if (error) throw error;
        
        alert('Transaction rejected and removed.');
        loadAdminTransactions();
      } catch (error) {
        alert('Error rejecting transaction: ' + error.message);
      }
    }

    document.getElementById('adminTaskForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = {
        brand_name: document.getElementById('adminBrandName').value,
        question: document.getElementById('adminQuestion').value,
        reward_amount: parseInt(document.getElementById('adminReward').value),
        user_target: parseInt(document.getElementById('adminTarget').value),
        image_urls: [document.getElementById('adminImageUrl').value],
        active_to: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
      };
      await supabaseClient.from('brand_tasks').insert(formData);
      alert('Task added!');
      e.target.reset();
    });

    document.getElementById('adminPromoForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = {
        title: document.getElementById('adminPromoTitle').value,
        description: document.getElementById('adminPromoDesc').value,
        video_url: document.getElementById('adminVideoUrl').value,
        reward_amount: parseInt(document.getElementById('adminPromoReward').value)
      };
      await supabaseClient.from('promotions').insert(formData);
      alert('Promotion added!');
      e.target.reset();
    });

    async function loadTaskResults() {
      try {
        const { data: tasks, error } = await supabaseClient
          .from('brand_tasks')
          .select('id, brand_name, question, user_target, reward_amount, created_at');
        
        if (error) throw error;
        
        const container = document.getElementById('taskResultsContainer');
        let html = '';
        
        for (const task of tasks) {
          // Get response count
          const { count: responseCount } = await supabaseClient
            .from('task_responses')
            .select('*', { count: 'exact' })
            .eq('task_id', task.id);
          
          // Get like/dislike breakdown
          const { data: responses } = await supabaseClient
            .from('task_responses')
            .select('liked')
            .eq('task_id', task.id);
          
          const likes = responses?.filter(r => r.liked === true).length || 0;
          const dislikes = responses?.filter(r => r.liked === false).length || 0;
          
          const progress = Math.round((responseCount / task.user_target) * 100);
          
          html += `
            <div class="task-result-card">
              <h4>${task.brand_name}</h4>
              <p><strong>Question:</strong> ${task.question}</p>
              <div class="task-stats">
                <div class="stat">
                  <span class="stat-number">${responseCount}</span>
                  <span class="stat-label">Responses</span>
                </div>
                <div class="stat">
                  <span class="stat-number">${task.user_target}</span>
                  <span class="stat-label">Target</span>
                </div>
                <div class="stat">
                  <span class="stat-number">${progress}%</span>
                  <span class="stat-label">Complete</span>
                </div>
                <div class="stat">
                  <span class="stat-number">${likes}</span>
                  <span class="stat-label">Likes</span>
                </div>
                <div class="stat">
                  <span class="stat-number">${dislikes}</span>
                  <span class="stat-label">Dislikes</span>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${progress}%"></div>
              </div>
            </div>
          `;
        }
        
        container.innerHTML = html || '<p>No tasks found</p>';
      } catch (error) {
        console.error('Error loading task results:', error);
        document.getElementById('taskResultsContainer').innerHTML = 
          '<p>Error loading task results</p>';
      }
    }

    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>
  <script src="script.js"></script>
</body>
</html>
